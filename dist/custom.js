const public_spreadsheet_url="https://docs.google.com/spreadsheets/d/1l4JL0SWvufEVlZnJzjAA_oIejsSbjQBEdfVSG4xQbpo/gviz/tq?tqx=out:csv&sheet=Sheet1";function init(){Papa.parse(public_spreadsheet_url,{download:!0,header:!0,error:showError,complete:showInfo})}function showError(e,t){let s=`\n    <div class="col-12">\n      <h2>Error Report</h2>\n      <p>There was an problem retrieving data from the source. Please contact City of Asheville IT Services for assistance. (help@ashevillenc.gov | 828-251-4000)</p>\n      <p>${e}</p>\n      <p>Spreadsheet target: ${public_spreadsheet_url}</p>\n      <p>File details: ${t}</p>\n    </div>\n  `;document.getElementById("object-filters").innerHTML="",document.getElementById("object-filters").className="",document.getElementById("view-switcher").innerHTML="",document.getElementById("food-locations").className="row",document.getElementById("food-locations").innerHTML=s}function showInfo(e){let t=e.data,s="",i="",l="",a=new Date;a.setHours(0,0,0,0);let o={},n="",r="",d="",c="",y="",p="",f="";window.filterOptions={areaLabels:[],areaValues:[],dayLabels:[],dayValues:[],typeLabels:[],typeValues:[]},window.filterSelectors=[],window.foodLocationsHTML="",window.foodLocationsPrintHTML="";for(let e of t){if(!e.name)break;if(s="",e.startDate.trim()?startDate=new Date(e.startDate):startDate=new Date("3/1/2020"),e.endDate.trim()?endDate=new Date(e.endDate):endDate=new Date("1/1/2100"),a<=endDate&&a>=startDate&&e.name.trim()){switch(e.generalArea.trim()&&(s+=(l="area-"+e.generalArea.trim().toLowerCase().replace(/[^0-9a-z]/gi,""))+" ",window.filterOptions.areaValues.indexOf(l)<0&&(window.filterOptions.areaLabels.push(e.generalArea.trim()),window.filterOptions.areaValues.push(l))),e.type.trim()&&(s+=(l="type-"+e.type.trim().toLowerCase().replace(/[^0-9a-z]/gi,""))+" ",window.filterOptions.typeValues.indexOf(l)<0&&(i="Students"===e.type.trim()?"Student Meals":e.type.trim(),window.filterOptions.typeLabels.push(i),window.filterOptions.typeValues.push(l))),e.mo.trim()?(s+="day-mo ",n="day-of-week--on",window.filterOptions.dayValues.indexOf("day-mo")<0&&(window.filterOptions.dayLabels.push("Monday"),window.filterOptions.dayValues.push("day-mo"))):n="day-of-week--off",e.tu.trim()?(s+="day-tu ",r="day-of-week--on",window.filterOptions.dayValues.indexOf("day-tu")<0&&(window.filterOptions.dayLabels.push("Tuesday"),window.filterOptions.dayValues.push("day-tu"))):r="day-of-week--off",e.we.trim()?(s+="day-we ",d="day-of-week--on",window.filterOptions.dayValues.indexOf("day-we")<0&&(window.filterOptions.dayLabels.push("Wednesday"),window.filterOptions.dayValues.push("day-we"))):d="day-of-week--off",e.th.trim()?(s+="day-th ",c="day-of-week--on",window.filterOptions.dayValues.indexOf("day-th")<0&&(window.filterOptions.dayLabels.push("Thursday"),window.filterOptions.dayValues.push("day-th"))):c="day-of-week--off",e.fr.trim()?(s+="day-fr ",y="day-of-week--on",window.filterOptions.dayValues.indexOf("day-fr")<0&&(window.filterOptions.dayLabels.push("Friday"),window.filterOptions.dayValues.push("day-fr"))):y="day-of-week--off",e.sa.trim()?(s+="day-sa ",p="day-of-week--on",window.filterOptions.dayValues.indexOf("day-sa")<0&&(window.filterOptions.dayLabels.push("Saturday"),window.filterOptions.dayValues.push("day-sa"))):p="day-of-week--off",e.su.trim()?(s+="day-su ",f="day-of-week--on",window.filterOptions.dayValues.indexOf("day-su")<0&&(window.filterOptions.dayLabels.push("Sunday"),window.filterOptions.dayValues.push("day-su"))):f="day-of-week--off",e.startTime.trim()||e.endTime.trim()?e.startTime.trim()&&!e.endTime.trim()?e.hoursOpen=`${e.startTime} onward`:!e.startTime.trim()&&e.endTime.trim()?e.hoursOpen=`Until ${e.endTime}`:e.hoursOpen=`${e.startTime} - ${e.endTime}`:e.hoursOpen="Hours not specified",e.startDate.trim()||e.endDate.trim()?e.startDate.trim()&&!e.endDate.trim()?e.daysOpen=`${moment(startDate).format("MMMM Do")} onward`:!e.startDate.trim()&&e.endDate.trim()?e.daysOpen=`Effective until ${moment(endDate).format("MMMM Do")}`:e.startDate.trim()===e.endDate.trim()?e.daysOpen=`${moment(startDate).format("MMMM Do")} Only`:e.daysOpen=`${moment(startDate).format("MMMM Do")} - ${moment(endDate).format("MMMM Do")}`:e.daysOpen="Dates not specified",e.type.trim()){case"Students":e.serviceIcon='<i class="fas fa-utensils service-student"></i>';break;case"Student Delivery Site":e.serviceIcon='<i class="fas fa-truck-loading service-delivery"></i>';break;case"Meal Pickup":e.serviceIcon='<i class="fas fa-toolbox service-meal"></i>';break;case"Food Box Pickup":e.serviceIcon='<i class="fas fa-shopping-basket service-foodbox"></i>';break;case"Farmers Market":e.serviceIcon='<i class="fas fa-tractor service-farmersmarket"></i>';break;default:e.serviceIcon=""}e.selectors=s,e.styleM=n,e.styleT=r,e.styleW=d,e.styleTh=c,e.styleF=y,e.styleSa=p,e.styleSu=f,o={objectID:e.geoid,selectors:s},window.filterSelectors.push(o),addCard(e),0}}console.log(window.filterSelectors);let h="";for(let e=0;e<window.filterOptions.areaValues.length;e++)h+=`<option value="${window.filterOptions.areaValues[e]}">${window.filterOptions.areaLabels[e]}</option>`;document.getElementById("filter-area").innerHTML+=h;let w="";for(let e=0;e<window.filterOptions.dayValues.length;e++)w+=`<option value="${window.filterOptions.dayValues[e]}">${window.filterOptions.dayLabels[e]}</option>`;document.getElementById("filter-day").innerHTML+=w;let u="";for(let e=0;e<window.filterOptions.typeValues.length;e++)u+=`<option value="${window.filterOptions.typeValues[e]}">${window.filterOptions.typeLabels[e]}</option>`;document.getElementById("filter-type").innerHTML+=u,document.getElementById("food-locations").innerHTML=window.foodLocationsHTML,document.getElementById("food-locations-print").innerHTML=window.foodLocationsPrintHTML;var m=new ObjectFilter;console.log(m)}function addCard(e){let t=encodeURIComponent(e.address);window.foodLocationsHTML+=`\n    <div class="col p-0 mb-5 all-objects object-${e.geoid} ${e.selectors}">\n      <div class="card inner m-3 h-100">\n        <div class="card-header"><h3>${e.name}</h3></div>\n        <ul class="list-group list-group-flush">\n          <li class="list-group-item">${e.generalArea}</li>\n          <li class="list-group-item">${e.serviceIcon} ${"Students"===e.type?"Student Meals":e.type}</li>\n          <li class="list-group-item">\n            <ul class="week-list" aria-label="Days of the week">\n              <li class="day-of-week ${e.styleM}" title="${e.name} ${e.type} service is ${"day-of-week--on"===e.styleM?"open":"closed"} on Monday"><span class="day-label">M</span></li>\n              <li class="day-of-week ${e.styleT}" title="${e.name} ${e.type} service is ${"day-of-week--on"===e.styleT?"open":"closed"} on Tuesday"><span class="day-label">T</span></li>\n              <li class="day-of-week ${e.styleW}" title="${e.name} ${e.type} service is ${"day-of-week--on"===e.styleW?"open":"closed"} on Wednesday"><span class="day-label">W</span></li>\n              <li class="day-of-week ${e.styleTh}" title="${e.name} ${e.type} service is ${"day-of-week--on"===e.styleTh?"open":"closed"} on Thursday"><span class="day-label">Th</span></li>\n              <li class="day-of-week ${e.styleF}" title="${e.name} ${e.type} service is ${"day-of-week--on"===e.styleF?"open":"closed"} on Friday"><span class="day-label">F</span></li>\n              <li class="day-of-week ${e.styleSa}" title="${e.name} ${e.type} service is ${"day-of-week--on"===e.styleSa?"open":"closed"} on Saturday"><span class="day-label">Sa</span></li>\n              <li class="day-of-week ${e.styleSu}" title="${e.name} ${e.type} service is ${"day-of-week--on"===e.styleSu?"open":"closed"} on Sunday"><span class="day-label">Su</span></li>\n            </ul>\n          </li>          \n          <li class="list-group-item">${e.hoursOpen}<br />${e.daysOpen}</li>\n          <li class="list-group-item"><a class="map-link text-dark" href="https://www.google.com/maps/search/${t}" title="View location of ${e.name} on a Google Map" target="_blank">Location</a>: ${e.address}</li>\n        </ul>\n      </div>\n    </div>\n  `,window.foodLocationsPrintHTML+=`\n    <tr class="all-objects object-${e.geoid} ${e.selectors}">\n      <td><h3>${e.name}</h3>${e.serviceIcon} ${"Students"===e.type?"Student Meals":e.type}</td>\n      <td>\n        <ul class="week-list week-list--print" aria-label="Days of the week">\n          <li class="day-of-week ${e.styleM}" title="${e.name} ${e.type} service is ${"day-of-week--on"===e.styleM?"open":"closed"} on Monday"><span class="day-label">M</span></li>\n          <li class="day-of-week ${e.styleT}" title="${e.name} ${e.type} service is ${"day-of-week--on"===e.styleT?"open":"closed"} on Tuesday"><span class="day-label">T</span></li>\n          <li class="day-of-week ${e.styleW}" title="${e.name} ${e.type} service is ${"day-of-week--on"===e.styleW?"open":"closed"} on Wednesday"><span class="day-label">W</span></li>\n          <li class="day-of-week ${e.styleTh}" title="${e.name} ${e.type} service is ${"day-of-week--on"===e.styleTh?"open":"closed"} on Thursday"><span class="day-label">Th</span></li>\n          <li class="day-of-week ${e.styleF}" title="${e.name} ${e.type} service is ${"day-of-week--on"===e.styleF?"open":"closed"} on Friday"><span class="day-label">F</span></li>\n          <li class="day-of-week ${e.styleSa}" title="${e.name} ${e.type} service is ${"day-of-week--on"===e.styleSa?"open":"closed"} on Saturday"><span class="day-label">Sa</span></li>\n          <li class="day-of-week ${e.styleSu}" title="${e.name} ${e.type} service is ${"day-of-week--on"===e.styleSu?"open":"closed"} on Sunday"><span class="day-label">Su</span></li>\n        </ul>\n        ${e.hoursOpen} | ${e.daysOpen}\n      </td>\n      <td>Area: ${e.generalArea}<br /><a class="map-link text-dark" href="https://www.google.com/maps/search/${t}" title="View location of ${e.name} on a Google Map" target="_blank">${e.address}</a></td>\n    </tr>\n  `}const test=document.addEventListener("DOMContentLoaded",init);console.log("Initializing now...");class ObjectFilter{constructor(){this.allObjects=$(".all-objects"),this.selectArea=$("#filter-area"),this.selectDay=$("#filter-day"),this.selectType=$("#filter-type"),this.showPrint=$("#show-print"),this.printReturn=$("#print-return"),this.showAll=$("#show-all"),this.filterProperties=["area","day","type"],this.filterPropertyLabels=["Area","Day of the week","Service Type"],this.filterSelections={areaKeys:[],areaLabels:[],dayKeys:[],dayLabels:[],typeKeys:[],typeLabels:[],matchedIDs:[],objectSelectors:[]},this.objectID=window.filterSelectors,this.events()}events(){$(".selected-filters").on("click",".filter-button",e=>{let t=e.target.attributes[2].nodeValue,s=this.filterSelections[`${t}Keys`].indexOf(e.target.attributes[1].nodeValue);s>=0&&(this.filterSelections[`${t}Keys`].splice(s,1),this.filterSelections[`${t}Labels`].splice(s,1)),$(`[data-filter-value='${e.target.attributes[1].nodeValue}']`).remove(),this.filterSelections[`${t}Keys`].length||$(`.selected-filters-default-${t}`).removeClass("object--hidden"),this.filtersRefresh()}),this.selectArea.change(()=>{this.filtersAdd.call(this,this.selectArea,"area")}),this.selectDay.change(()=>{this.filtersAdd.call(this,this.selectDay,"day")}),this.selectType.change(()=>{this.filtersAdd.call(this,this.selectType,"type")}),this.showAll.on("click",()=>{this.allObjects.removeClass("object--hidden");for(let e=0;e<this.filterProperties.length;e++)this.filterSelections[`${this.filterProperties[e]}Keys`].length=0,this.filterSelections[`${this.filterProperties[e]}Labels`].length=0,$(`#list-group-${this.filterProperties[e]}`).html(`<li class="list-group-item selected-filters-default-${this.filterProperties[e]}">Any ${this.filterPropertyLabels[e]}</li>`);this.filterSelections.matchedIDs.length=0,this.filterSelections.objectSelectors=""}),this.showPrint.on("click",()=>{this.printToggle()}),this.printReturn.on("click",()=>{this.printToggle()})}printToggle(){$(".no-print").toggleClass("object--hidden"),$(".print-view").toggleClass("object--hidden"),$("#show-print").toggleClass("object--hidden"),$("#print-return").toggleClass("object--hidden")}filtersRefresh(){let e=this.objectID.slice(),t=[];this.filterProperties.forEach(s=>{this.filterSelections[`${s}Keys`].length&&(t=e.filter(e=>{let t=0;return this.filterSelections[`${s}Keys`].forEach(s=>{e.selectors.indexOf(s)>=0&&t++}),t}),e=t.slice(),t.length=0)}),this.filterSelections.matchedIDs.length=0,this.filterSelections.matchedIDs=e.slice(),this.filterSelections.objectSelectors="";let s=0;this.filterSelections.matchedIDs.forEach(e=>{this.filterSelections.objectSelectors+=".object-"+e.objectID,++s<this.filterSelections.matchedIDs.length&&(this.filterSelections.objectSelectors+=", ")}),console.log("Refreshing Filters:"),console.log(this.filterSelections.matchedIDs),console.log(this.filterSelections.objectSelectors),this.allObjects.addClass("object--hidden"),this.filterSelections.matchedIDs.length?($(`${this.filterSelections.objectSelectors}`).toggleClass("object--hidden"),$("#no-results").removeClass("no-results--on")):$("#no-results").addClass("no-results--on")}filtersAdd(e,t){this.filterSelections[`${t}Keys`].indexOf(e.val())<0&&(this.filterSelections[`${t}Keys`].push(e.val()),this.filterSelections[`${t}Labels`].push(e.children("option:selected").text()),console.log("Adding Filter - "+t),this.filtersRefresh(),$(`#list-group-${t}`).append(` <li class="list-group-item filter-button" data-filter-value="${e.val()}" data-filter-type="${t}" title="Click to remove this filter">${e.children("option:selected").text()}</li>`),$(`.selected-filters-default-${t}`).addClass("object--hidden")),e[0].selectedIndex=0}}
